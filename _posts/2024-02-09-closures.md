---
title: "Closures"
excerpt: ""
date: 2024-01-29 00:00:00 -03:00
classes: wide
categories:
  - blog
tags:
  - unity
  - c#
  - ui
---

Take a look at the following code snippet:
```csharp
public class MyButton : MonoBehaviour
{
    [SerializeField] Button button;

    void Awake()
    {
        for (int i = 0; i < 5; i++)
        {
            button.onClick.AddListener(() => Debug.Log(i));    
        }
    }
}
```
It's a bit weird, but mostly harmless right?
Think about it a little, what's it going to print when the button is clicked?

<details> 
  <summary>Here's the answer:</summary>
  It prints "5" 5 times. 
</details>
<br>

Now let's try this one:
```csharp
public class MyButton : MonoBehaviour
{
    [SerializeField] Button button;

    void Awake()
    {
        for (int i = 0; i < 5; i++)
        {
            int index = i;
            button.onClick.AddListener(() => Debug.Log(index));    
        }
    }
}
```
Now it prints "0", "1", "2", "3" and "4".  
Why is that?  
The answer is closures. Actually it has to do with scopes too, but let's focus on the closure here.

# Closures

## Definition
https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/lambda-expressions#capture-of-outer-variables-and-variable-scope-in-lambda-expressions

When a function references 


## Compiler output

## Handmade code

## Temporary allocations and Garbage collection

## Conclusion